<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Trajet Livreur</title>

<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
#map {
    height: calc(100vh - 80px);
    width: 100%;
}
</style>
</head>

<body>

<nav class="navbar">
    <div class="nav-container">
        <div class="logo">
            <i class="fas fa-truck"></i>
            <span>Smart Delivery</span>
        </div>

        <ul class="nav-menu">
            <li><a href="/livreurDashboard">Dashboard</a></li>
            <li><a href="/logout">Déconnexion</a></li>
        </ul>
    </div>
</nav>

<div id="map"></div>

<script>
const map = L.map('map').setView([31.63, -7.99], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
}).addTo(map);

async function chargerTrajet() {
    const res = await fetch("/api/livreur/trajet");
    const data = await res.json();

    if (!data.success) {
        alert("Aucun trajet disponible");
        return;
    }

    const geometry = data.trajet.route_geometry;

    const latlngs = geometry.map(p => [p[1], p[0]]);


    const polyline = L.polyline(latlngs, {
        color: 'blue',
        weight: 5
    }).addTo(map);

    // markers
    L.marker(latlngs[0]).addTo(map).bindPopup("Départ");
    L.marker(latlngs[latlngs.length - 1]).addTo(map).bindPopup("Dernière livraison");

    map.fitBounds(polyline.getBounds());
}

chargerTrajet();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Suivi Temps R√©el - Smart Delivery</title>

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f6fa;
        color: #333;
      }

      #map {
        height: 100vh;
        width: calc(100vw - 320px);
        float: right;
      }

      .sidebar {
        width: 320px;
        height: 100vh;
        background: #ffffff;
        border-right: 1px solid #ddd;
        padding: 25px 20px;
        position: fixed;
        left: 0;
        top: 0;
        overflow-y: auto;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
      }

      .sidebar h2 {
        font-size: 24px;
        color: #007bff;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .info-box {
        background: #f0f4ff;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 5px solid #007bff;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
      }

      .info-box strong {
        display: block;
        color: #333;
        margin-bottom: 5px;
      }

      .info-box span {
        font-weight: bold;
        color: #444;
      }

      .btn-full,
      .btn-secondary {
        display: block;
        width: 100%;
        padding: 12px 16px;
        font-size: 16px;
        margin-bottom: 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s ease;
      }

      .btn-full {
        background: #007bff;
        color: white;
      }

      .btn-full:hover {
        background: #0056c2;
      }

      .btn-secondary {
        background: #e4e6eb;
        color: #333;
      }

      .btn-secondary:hover {
        background: #d0d3da;
      }

      @media (max-width: 768px) {
        #map {
          width: 100%;
          height: calc(100vh - 300px);
        }

        .sidebar {
          position: relative;
          width: 100%;
          height: auto;
          float: none;
        }
      }
    </style>
  </head>

  <body>
    <div class="sidebar">
      <h2><i class="fas fa-truck-moving"></i> Suivi Temps R√©el</h2>

      <div class="info-box">
        <strong><i class="fas fa-user"></i> Livreur :</strong>
        <span id="livreur-nom">Livreur A</span>
      </div>

      <div class="info-box">
        <strong><i class="fas fa-location-dot"></i> Position actuelle :</strong>
        <span id="pos-actuelle">--</span>
      </div>

      <div class="info-box">
        <strong><i class="fas fa-gauge"></i> Vitesse :</strong>
        <span id="vitesse">-- km/h</span>
      </div>

      <div class="info-box">
        <strong><i class="fas fa-info-circle"></i> Statut :</strong>
        <span id="statut">En attente‚Ä¶</span>
      </div>

      <button class="btn-full" onclick="lancerSimulation()">
        ‚ñ∂Ô∏è Lancer la Simulation
      </button>
      <button class="btn-secondary" onclick="recentrer()">
        üéØ Recentrer la Carte
      </button>
    </div>

    <div id="map"></div>

    <script>
      let map = L.map("map").setView([31.6308, -8.0086], 15);
      let marker = null;
      let polyline = null;
      let positions = [];
      let simulationInterval = null;

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "¬© OpenStreetMap",
      }).addTo(map);

      let position = { lat: 31.6308, lng: -8.0086 };

      function afficherPointInitial() {
        marker = L.marker([position.lat, position.lng]).addTo(map);
      }

      afficherPointInitial();

      function genererDeplacement() {
        position.lat += (Math.random() - 0.5) * 0.0005;
        position.lng += (Math.random() - 0.5) * 0.0005;

        marker.setLatLng([position.lat, position.lng]);
        positions.push([position.lat, position.lng]);

        if (polyline) {
          polyline.setLatLngs(positions);
        } else {
          polyline = L.polyline(positions, { color: "blue", weight: 4 }).addTo(
            map
          );
        }

        document.getElementById("pos-actuelle").textContent =
          position.lat.toFixed(5) + ", " + position.lng.toFixed(5);
        document.getElementById("vitesse").textContent =
          (20 + Math.random() * 10).toFixed(1) + " km/h";
        document.getElementById("statut").textContent = "En livraison‚Ä¶";
      }

      function lancerSimulation() {
        if (polyline) polyline.remove();
        positions = [];
        document.getElementById("statut").textContent = "D√©marrage‚Ä¶";
        simulationInterval = setInterval(genererDeplacement, 1000);
      }

      function recentrer() {
        map.setView([position.lat, position.lng], 16);
      }
    </script>
  </body>
</html>
